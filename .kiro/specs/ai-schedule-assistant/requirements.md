# 要件定義書

## 概要

この機能は、複数のクライアントプロジェクトを管理する個人開発者・フリーランサー向けのAI搭載スケジュールアシスタントを実装します。システムはGoogle Calendarと連携し、AI駆動のタスク提案を提供し、インテリジェントなタスク分解と優先度付けを通じて100%のスケジュール把握と80%以上のタスク完遂率の達成を支援します。

## 実装優先度

**MVP（最小実行可能製品）:** 要件1, 2, 3, 4, 5
**フェーズ2（品質向上）:** 要件6, 7, 8, 9, 10  
**フェーズ3（高度機能）:** 要件11, 12

## 要件

### 要件1

**ユーザーストーリー:** フリーランス開発者として、Google Calendarイベントを双方向同期したい。これにより、アシスタントと既存のカレンダーワークフローの両方からスケジュールを管理できるようになる。

#### 受入基準

1. ユーザーがGoogle OAuth2で認証した時、システムは当日のすべてのカレンダーイベントを取得すること
2. アシスタントで新しいイベントが作成された時、システムはGoogle Calendarに対応するイベントを作成すること
3. Google Calendarでイベントが変更された時、システムは5分以内にローカルイベントデータを更新すること
4. どちらかのシステムでイベントが削除された時、システムは他方のシステムにも削除を同期すること
5. Google Calendar APIが利用できない場合、システムはキャッシュされたイベントを表示し、変更を後で同期するためにキューに入れること

### 要件2

**ユーザーストーリー:** 忙しい開発者として、会議やイベントの準備タスクをAIに自動生成してもらいたい。これにより、重要な準備作業を忘れることがなくなる。

#### 受入基準

1. 新しいカレンダーイベントが作成された時、AIはイベント詳細を分析して関連する準備タスクを生成すること
2. 準備タスクが生成された時、システムは各タスクの所要時間を見積もること
3. 複数の準備タスクが存在する時、システムは緊急度と重要度に基づいて優先順位を付けること
4. イベントのコンテキストが不十分な場合、システムは汎用的な準備タスク（議題確認、資料準備）を生成すること
5. 準備タスクが完了した時、システムはそれらを完了としてマークし、完了統計を更新すること

### 要件3

**ユーザーストーリー:** 複数プロジェクトを管理する開発者として、優先度ランキング付きのAI搭載タスク提案が欲しい。これにより、決断疲れなしに高インパクトな作業に集中できる。

#### 受入基準

1. ユーザーが日次タスク提案を要求した時、AIはカレンダーの空き時間を分析し、推定時間付きのタスクを提案すること
2. タスクが提案された時、システムはアイゼンハワーマトリックスの原則を使用して優先度レベルを割り当てること
3. 複数のタスクが同じ時間枠で競合する時、システムはビジネスインパクトと緊急度でランク付けすること
4. ユーザーが提案にフィードバックを提供した時、システムは学習して将来の推奨を改善すること
5. 利用可能時間が30分未満の場合、システムは短時間タスクまたは準備作業のみを提案すること

### 要件4

**ユーザーストーリー:** 集中を維持する必要がある開発者として、今後のタスクやイベントのタイムリーな通知が欲しい。これにより、活動間をスムーズに移行できる。

#### 受入基準

1. タスクまたはイベントが15分後に開始予定の時、システムはブラウザ通知を送信すること
2. 高優先度タスクが期限の2時間前に未完了の時、システムは緊急通知を送信すること
3. ユーザーがタスクを完了した時、システムは即座にフィードバックを提供し、日次進捗を更新すること
4. ブラウザ通知が無効な場合、システムはメール通知にフォールバックすること
5. ユーザーが集中モードの時、システムは緊急でない通知を後で配信するためにキューに入れること

### 要件5

**ユーザーストーリー:** 生産性を追跡する開発者として、日次レビューと未完了タスクの自動リスケジュールが欲しい。これにより、何も見落とすことがなくなる。

#### 受入基準

1. 18:00に一日が終了した時、システムは自動的に完了サマリーを生成すること
2. 未完了タスクが存在する時、システムは翌日のリスケジュールオプションを提案すること
3. ユーザーが日次進捗をレビューする時、システムは完了率と生産性メトリクスを表示すること
4. タスクが継続的に延期される時、システムはそれらをより小さなサブタスクに分割することを提案すること
5. タスクが3回以上延期された場合、システムはユーザーレビューと削除の可能性のためにフラグを立てること

### 要件6

**ユーザーストーリー:** セキュリティを重視する開発者として、開発効率を損なわない適切な認証とデータ保護が欲しい。これにより、機密のスケジュール情報を保護しつつ、スムーズな開発・テストが可能になる。

#### 受入基準

1. ユーザーがログインした時、システムは開発環境では簡易認証、本番環境ではPKCE付きOAuth2を使用すること
2. 開発中は認証をバイパスできるテストモードを提供し、本番リリース時に完全な認証を有効化すること
3. APIトークンが保存される時、システムは環境に応じた適切なストレージ方式を使用すること（開発：ローカルストレージ、本番：暗号化ストレージ）
4. データベースアクセスは、開発初期は基本的なuser_id フィルタリングで実装し、MVP完成後にRLS（行レベルセキュリティ）ポリシーを段階的に導入すること
5. セキュリティ機能は段階的実装とし、コア機能完成後に強化すること（フェーズ1：基本認証、フェーズ2：暗号化、フェーズ3：RLS完全実装）

### 要件7

**ユーザーストーリー:** コストを意識するフリーランサーとして、システムを月額30ドル以内の予算で運用したい。これにより、ツールが経済的に実行可能であり続ける。

#### 受入基準

1. AI提案が生成される時、システムは月間50万トークン以内に留まるようOpenAI API呼び出しを制限すること
2. トークン使用量が制限の80%に近づいた時、システムはコスト最適化のためGPT-3.5に切り替えること
3. データベース使用量が無料枠制限を超える時、システムは追加料金が発生する前にユーザーに警告すること
4. 通知量が多い時、システムはSendGrid無料制限内に留まるよう通知をバッチ処理すること
5. 月額コストが25ドルを超えた場合、システムは自動的にAI提案頻度を削減すること

### 要件8

**ユーザーストーリー:** 複数デバイスで作業する開発者として、デスクトップとモバイルブラウザの両方でレスポンシブなパフォーマンスが欲しい。これにより、どこからでもスケジュールにアクセスできる。

#### 受入基準

1. ユーザーがアプリケーションを読み込む時、UIはリクエストの95%で300ms以内に応答すること
2. AI処理が必要な時、システムはP95で2秒以内、P99で5秒以内に提案を完了すること
3. アプリケーションがモバイルでアクセスされる時、システムは完全に機能するレスポンシブインターフェースを提供すること
4. システムが負荷下にある時、システムは月間99.5%のアップタイムを維持すること
5. パフォーマンスが低下した場合、システムは自動的にリソースをスケールするか、優雅に劣化すること

### 要件9

**ユーザーストーリー:** AI提案の品質を信頼したい開発者として、提案精度の継続的な改善と透明性が欲しい。これにより、AIアシスタントを安心して使用できる。

#### 受入基準

1. AI提案の採用率が60%以上を維持した時、システムは提案品質が良好であることを確認すること
2. AI提案が生成される時、システムは提案理由を日本語で説明すること（「このタスクは〇〇の理由で優先度が高いです」）
3. ユーザーが提案を拒否した時、システムは拒否理由を学習データとして記録すること
4. AI推論が失敗した時、システムは過去の成功パターンに基づくフォールバック提案を提供すること
5. 提案精度が50%を下回った場合、システムは自動的にプロンプトを調整し、管理者に通知すること

### 要件10

**ユーザーストーリー:** 非エンジニアでも理解できるシステムを求める開発者として、分かりやすいエラーメッセージとガイダンスが欲しい。これにより、技術的な問題に時間を取られることなく作業に集中できる。

#### 受入基準

1. システムエラーが発生した時、システムは技術用語を使わずに問題と解決策を日本語で説明すること
2. AI提案が期待と異なる時、システムは「なぜこの提案をしたか」の理由を具体的に表示すること
3. 設定変更が必要な時、システムは手順を段階的に日本語で案内すること
4. データ同期に問題がある時、システムは「Google Calendarとの接続を確認してください」など具体的な対処法を提示すること
5. 予期しない動作が発生した場合、システムは問題報告の方法を分かりやすく案内すること

### 要件11

**ユーザーストーリー:** データ品質を重視する開発者として、AI学習データの継続的な改善とデータドリフト対策が欲しい。これにより、長期的にシステムの精度を維持できる。

#### 受入基準

1. ユーザーフィードバックが100件以上蓄積された時、システムは月次でプロンプト調整を実行すること
2. 提案採用率が過去30日平均から20%以上低下した時、システムはアラートを発生させること
3. 新しいプロジェクトタイプが追加された時、システムは関連キーワードを学習データに追加すること
4. 明らかに異常なデータ（負の時間、未来の完了日など）が検出された時、システムは自動的に除外すること
5. システム全体の提案精度が30%を下回った場合、システムはデフォルトの汎用提案に切り替えること

### 要件12

**ユーザーストーリー:** 目標達成に苦戦する開発者として、AIメンターからの現状分析と改善提案が欲しい。これにより、タスク消化の障害を特定し、生産性を向上させることができる。

#### 受入基準

1. タスク完了率が目標の80%を3日連続で下回った時、システムは「振り返りセッション」ボタンを表示すること
2. 未完了タスクが5個以上蓄積された時、システムは要因分析（時間不足、優先度判断ミス、タスク過大評価）を実行し、最も可能性の高い要因を日本語で表示すること
3. 見積もり時間と実際時間の差が平均50%以上になった時、システムは「見積もり精度向上のための15分振り返り」を翌日のスケジュールに提案すること
4. 完了率が過去7日間で連続低下している時、システムは「今週は完了率が低下傾向です。タスクを小分けしてみませんか？」など具体的な改善案を1つ提示すること
5. 1日の作業時間が10時間を超えるか、タスクが3回以上連続延期された時、システムは「休憩時間を設けることをお勧めします」と提案すること